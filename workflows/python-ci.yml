name: Python CI

on:
  push:
    branches: [ "main" ]  # –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø—É—à–µ –≤ main
  pull_request:
    branches: [ "main" ]  # –∏ –ø—Ä–∏ PR

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
    - name: üì• –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
      uses: actions/checkout@v3

    - name: üêç –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.13'

    - name: ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
      run: |
        python -m pip install --upgrade pip
        pip install pytest pytest-cov

    - name: üß™ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
      run: |
        pytest --cov=car_rental --cov-report=term

    - name: üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å HTML-–æ—Ç—á–µ—Ç –ø–æ–∫—Ä—ã—Ç–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
      if: always()
      run: |
        pytest --cov=car_rental --cov-report=html
        mkdir -p coverage_report
        cp -r htmlcov/* coverage_report/
      continue-on-error: true

    - name: üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ—Ç—á–µ—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: coverage-html
        path: coverage_report/
